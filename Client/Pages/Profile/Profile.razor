@page "/profile"
@using Cargotruck.Shared.Resources
@using Microsoft.AspNetCore.Identity
@using Microsoft.Extensions.Localization
@inject IStringLocalizer<Resource> localizer


<h1 class="h4 font-weight-normal login-title ">
    @localizer["Profile"]
</h1>

<div class="col-md-8 stretch-card">
    <div class="card" >
        <div class="card-body" >
            <AuthorizeView>
                <Authorized>
                    <ul >

                        @foreach (var claim in context.User.Claims){
                            //<li>@claim.Type: @claim.Value</li>

                            @if (@claim.Type.Contains("img"))
                            {
                                <img src="@claim.Value" class="profile_picture" alt="profile">
                            }
                            <table class="table d-inline-block align-left" style="margin-left:6%;">
                           
                            @if(@claim.Type.Contains("role")){
                                <tr>
                                    <td><b>@localizer["Username"]:</b></td>
                                    <td>@context.User.Identity.Name</td>
                                </tr>
                                <tr>
                                    <td><b>@localizer["Role"]:</b></td>
                                    <td>@claim.Value</td>
                                </tr>
                              
                            }
                            @if (@claim.Type.Contains("phonenumber")){
                                <tr>      
                                    <td><b>@localizer["Phone_number"]:</b></td>
                                     <td>@claim.Value</td>
                                </tr>
                              
                            }
                            @if ()
                            {
                                <tr>
                                    <td><b>@localizer["Email"]:</b></td>
                                    <td>@claim.Value</td>
                                </tr>

                            }
                        </table>
                        }
                    <tr>
                        <td><a class="btn btn-sm btn-primary btn-block m-4" href="Admin/edit/@context.User.Identity.Name"> <span class="oi oi-pencil" aria-hidden="true"></span> @localizer["Edit"]</a></td>
                    </tr>
                    </ul>
                </Authorized>
                <Authorizing>
                    <img src="~/css/img/loading.gif" alt="loading" width="500" height="600">
                </Authorizing>
            </AuthorizeView>
        </div>
    </div>
</div>

@code {
        [CascadingParameter]
        private Task<AuthenticationState> authenticationStateTask { get; set; }

        [Inject]
        UserManager<IdentityUser> userManager { get; set; }

    protected override async Task OnInitializedAsync()
    {
        var user = (await authenticationStateTask).User;

        if (user.Identity.IsAuthenticated)
        {
            var currentUser = await userManager.GetUserAsync(user);
            var currentUserId = currentUser.Id;
            var currentUserEmail = currentUser.Email;
            var currentUserPhone = currentUser.PhoneNumber;
        }
    }

}
   